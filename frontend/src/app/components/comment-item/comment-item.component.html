<div *ngIf="comment" class="comment-card">
  <div class="comment-header">
    <span class="comment-author">{{ comment.authorName }}</span>
    <span class="comment-date">{{ formatDate(comment.createdAt) }}</span>
  </div>
  
  <!-- Edit mode -->
  <div *ngIf="editing" class="edit-comment-form">
    <textarea
      [(ngModel)]="editText"
      [placeholder]="'USER.COMMENT_PLACEHOLDER' | translate"
      class="edit-comment-input"
      rows="3"
    ></textarea>
    <div class="edit-comment-actions">
      <button
        class="btn btn-primary btn-sm"
        [disabled]="!editText.trim() || isLoading"
        (click)="saveEdit()"
      >
        {{ 'COMMON.SAVE' | translate }}
      </button>
      <button
        class="btn btn-secondary btn-sm"
        (click)="cancelEdit()"
        [disabled]="isLoading"
      >
        {{ 'COMMON.CANCEL' | translate }}
      </button>
    </div>
  </div>

  <!-- Display mode -->
  <div *ngIf="!editing" class="comment-text" [class.expanded]="isExpanded">
    {{ getDisplayText(comment.text, isExpanded) }}
    <button
      *ngIf="isTextTooLong(comment.text)"
      class="text-expand-btn"
      (click)="toggleExpansion()"
    >
      {{ isExpanded ? ('PROFILE.SHOW_LESS' | translate) : ('PROFILE.SHOW_MORE' | translate) }}
    </button>
  </div>

  <!-- comment actions -->
  <div *ngIf="!editing" class="comment-actions">
    <button class="btn-reply" (click)="startReply()" [disabled]="isOtherEditing">
      <i class="fa fa-reply"></i> {{ 'USER.REPLY' | translate }}
    </button>
    <!-- Edit button (only for author) -->
    <button
      *ngIf="isCommentAuthor()"
      class="btn-edit"
      (click)="startEdit()"
      [disabled]="isOtherEditing"
    >
      <i class="fa fa-pencil"></i> {{ 'COMMON.EDIT' | translate }}
    </button>
    <!-- Delete button (for author or admin) -->
    <button
      *ngIf="canDeleteComment()"
      class="btn-delete"
      (click)="deleteComment()"
    >
      <i class="fa fa-trash"></i> {{ 'COMMON.DELETE' | translate }}
    </button>
  </div>

  <!-- reply form -->
  <div *ngIf="replying" class="reply-form">
    <textarea
      [(ngModel)]="replyText"
      [placeholder]="'USER.REPLY_PLACEHOLDER' | translate"
      class="reply-input"
      rows="2"
    ></textarea>
    <div class="reply-actions">
      <button
        class="btn btn-primary btn-sm"
        [disabled]="!replyText.trim() || isLoading"
        (click)="addReply()"
      >
        {{ 'USER.REPLY' | translate }}
      </button>
      <button
        class="btn btn-secondary btn-sm"
        (click)="cancelReply()"
        [disabled]="isLoading"
      >
        {{ 'USER.CANCEL' | translate }}
      </button>
    </div>
  </div>

  <!-- replies -->
  <div *ngIf="comment.replies && comment.replies.length > 0" class="replies-container">
    <app-reply-item
      *ngFor="let reply of comment.replies"
      [reply]="reply"
      [parentCommentId]="comment.id || comment._id || ''"
      [userId]="userId"
      [isAdmin]="isAdmin"
      [isEditing]="isReplyBeingEdited(reply.id || reply._id)"
      [isOtherEditing]="editing || replying || (editingReplyId !== null && editingReplyId !== (reply.id || reply._id))"
      [maxTextLength]="maxTextLength"
      [isExpanded]="isReplyExpanded(reply.id || reply._id)"
      (replyUpdated)="onReplyUpdated($event)"
      (replyDeleted)="onReplyDeleted($event)"
      (editStarted)="onReplyEditStarted($event)"
      (editCancelled)="onReplyEditCancelled()"
      (expansionToggled)="onReplyExpansionToggled($event)"
    ></app-reply-item>
  </div>
</div>

