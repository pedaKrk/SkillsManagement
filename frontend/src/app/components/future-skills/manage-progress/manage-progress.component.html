<div class="container">
  <h1>Manage Progress</h1>

  <!-- Add New Button -->
  <div class="actions">
    <button class="btn primary" (click)="addNewSkill()">+ ADD NEW FUTURE-SKILL</button>
  </div>

  <!-- Search & Filters -->
  <div class="search-container">
    <input type="text" class="search-box" placeholder="Search Future-Skills" (input)="filterSkills($event)">
    <button class="btn secondary" (click)="toggleFilterDropdown()">Apply Filters</button>
  </div>

  <!-- Filter Dropdown -->
  <div class="filter-dropdown" *ngIf="isFilterOpen">
    <div class="filter-container">
      <label>Skill Level</label>
      <select [(ngModel)]="selectedLevel">
        <option value="">All Levels</option>
        <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
      </select>
      <!-- Lecturer Dropdown -->
      <label>Lecturer Name</label>
      <select class="filter-input" [(ngModel)]="selectedLecturerId">
        <option value="">All Lecturers</option>
        <option *ngFor="let lecturer of lecturers" [value]="lecturer._id">
          {{ lecturer.title }} {{ lecturer.firstName }} {{ lecturer.lastName }}
        </option>
      </select>
      <!-- Skill Dropdown -->
      <label>Skill</label>
      <select class="filter-input" [(ngModel)]="selectedSkillId">
        <option value="">All Skills</option>
        <option *ngFor="let skill of skillOptions" [value]="skill._id">
          {{ skill.name }}
        </option>
      </select>
      <label>Expected Date</label>
      <input type="date" class="filter-input" [(ngModel)]="expectedDate" />

      <button class="btn primary" (click)="applyFilters()">Apply Filters</button>
      <button class="btn secondary" (click)="resetFilters()">Reset Filters</button>
    </div>
  </div>

  <!-- Skills Table -->
  <div class="table-container">
    <table class="skills-table">
      <thead>
      <tr>
        <th data-label="#No.">#No.</th>
        <th data-label="Lecturer Name">Lecturer Name</th>
        <th data-label="Skill Name">Skill Name</th>
        <th data-label="Skill Level">Skill Level</th>
        <th data-label="Expected Date">Expected Date</th>
        <th data-label="Actions">Actions</th>
      </tr>
      </thead>
      <tbody>

      <!-- Row for Adding New Skill -->
      <tr *ngIf="addingNewSkill && lecturers.length > 0 && skillOptions.length > 0">
        <td data-label="#No.">{{ skills.length + 1 }}</td>
        <td data-label="Lecturer Name">
          <select [(ngModel)]="newSkill.lecturer_id">
            <option value="">Select Lecturer</option>
            <option *ngFor="let lecturer of lecturers" [value]="lecturer._id">
              {{ lecturer.title }} {{ lecturer.firstName }} {{ lecturer.lastName }}
            </option>
          </select>
        </td>
        <td data-label="Skill Name">
          <select [(ngModel)]="newSkill.skill_id">
            <option value="">Select Skill</option>
            <option *ngFor="let skill of skillOptions" [value]="skill._id">{{ skill.name }}</option>
          </select>
        </td>
        <td data-label="Skill Level">
          <select [(ngModel)]="newSkill.future_achievable_level">
            <option value="">Select Level</option>
            <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
          </select>
        </td>
        <td data-label="Expected Date">
          <input type="date" [(ngModel)]="newSkill.target_date" />
        </td>
        <td data-label="Actions" class="actions-column">
          <div class="action-buttons">
            <button class="btn btn-icon btn-save" (click)="saveNewSkill()" title="Save">
              <i class="fas fa-save"></i>
            </button>
            <button class="btn btn-icon btn-cancel" (click)="cancelNewSkill()" title="Cancel">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </td>
      </tr>

      <!-- Future Skills Rows -->
      <tr *ngFor="let skill of skills; let i = index">
        <td data-label="#No.">{{ i + 1 }}</td>

        <!-- Editable Row -->
        <ng-container *ngIf="editingIndex === i; else readOnlyRow">
          <td data-label="Lecturer Name">
            <select [(ngModel)]="skill.lecturer_id">
              <option value="">Select Lecturer</option>
              <option *ngFor="let lecturer of lecturers" [ngValue]="lecturer">
                {{ lecturer.title }} {{ lecturer.firstName }} {{ lecturer.lastName }}
              </option>
            </select>
          </td>
          <td data-label="Skill Name">
            <select [(ngModel)]="skill.skill_id">
              <option value="">Select Skill</option>
              <option *ngFor="let skillOption of skillOptions" [ngValue]="skillOption">
                {{ skillOption.name }}
              </option>
            </select>
          </td>
          <td data-label="Skill Level">
            <select [(ngModel)]="skill.future_achievable_level">
              <option value="">Select Level</option>
              <option *ngFor="let level of skillLevels" [value]="level">{{ level }}</option>
            </select>

          </td>
          <td data-label="Expected Date">
            <input type="date" [(ngModel)]="skill.target_date" />
          </td>

          <td data-label="Actions" class="actions-column">
            <div class="action-buttons">
              <button class="btn btn-icon btn-save" (click)="saveEdit()" title="Save">
                <i class="fas fa-save"></i>
              </button>
              <button class="btn btn-icon btn-cancel" (click)="cancelEdit()" title="Cancel">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
        </ng-container>


        <!-- Read-Only Row -->
        <ng-template #readOnlyRow>
          <td data-label="Lecturer Name">{{ skill.lecturer_id?.title }} {{ skill.lecturer_id?.firstName }} {{ skill.lecturer_id?.lastName }}</td>
          <td data-label="Skill Name">{{ skill.skill_id?.name }}</td>
          <td data-label="Skill Level">{{ skill.future_achievable_level }}</td>
          <td data-label="Expected Date">{{ skill.target_date | date: 'yyyy-MM-dd' }}</td>
          <td data-label="Actions" class="actions-column">
            <div class="action-buttons">
              <button class="btn btn-icon btn-edit" (click)="editSkill(i)" title="Edit">
                <i class="fa fa-cog"></i>
              </button>
              <button class="btn btn-icon btn-mail" (click)="sendMail(skill)" title="Send Mail">
                <i class="fas fa-envelope"></i>
              </button>
              <button class="btn btn-icon btn-add" (click)="addToSkills(skill)" title="Add to Skills">
                <i class="fas fa-plus"></i>
              </button>
              <button class="btn btn-icon btn-delete" (click)="deleteSkill(i)" title="Delete">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </td>
        </ng-template>
    </tr>
    </tbody>
  </table>
</div>

<!--  EMAIL MODAL -->
<div class="email-modal" *ngIf="emailModalOpen">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Send Email</h2>
      <div class="email-section">
      <label class="field-label">To:</label>
      <div class="field-value">{{ emailData.recipient }}</div>
    </div>

    <div class="email-section">
      <label class="field-label">Subject:</label>
      <div class="field-value">{{ emailData.subject }}</div>
    </div>
    <textarea [(ngModel)]="emailData.message" rows="10" cols="60"></textarea>

    <div class="modal-actions">
      <button class="btn primary" (click)="sendEmail()">Send</button>
      <button class="btn secondary" (click)="emailModalOpen = false">Cancel</button>
    </div>
  </div>
</div>
</div>
</div>
