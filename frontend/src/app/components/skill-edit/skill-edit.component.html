<div class="skill-edit-container">
  <div class="header-section">
    <div class="header-box">
    <div class="page-header">
      <button mat-icon-button (click)="goBack()" class="back-btn">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1>{{ 'SKILL_EDIT.TITLE' | translate }}</h1>
      <button mat-icon-button (click)="openDetailedHelp()" class="help-btn" matTooltip="{{ 'SKILL_EDIT.SHOW_TUTORIAL' | translate }}">
        <mat-icon>help_outline</mat-icon>
      </button>
    </div>
    <p class="page-description">
      {{ 'SKILL_EDIT.DESCRIPTION' | translate }}
    </p>
    
    <!-- Simple Help Text -->
    <div class="simple-help" *ngIf="!tutorialShown">
      <p class="help-text">
        <mat-icon>mouse</mat-icon>
        {{ 'SKILL_EDIT.SIMPLE_HELP' | translate }}
      </p>
    </div>
    
    <!-- Detailed Help (only when user clicks help button) -->
    <div class="detailed-help" *ngIf="showDetailedHelp">
      <div class="help-card">
        <div class="help-header">
          <h3>{{ 'SKILL_EDIT.QUICK_GUIDE_TITLE' | translate }}</h3>
          <button mat-icon-button (click)="hideDetailedHelp()" class="close-help">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="help-tip">
          <mat-icon>info</mat-icon>
          <span>{{ 'SKILL_EDIT.HOVER_TIP' | translate }}</span>
        </div>
        
        <ul class="help-steps">
          <li><mat-icon>edit</mat-icon> {{ 'SKILL_EDIT.GUIDE_EDIT' | translate }}</li>
          <li><mat-icon>add</mat-icon> {{ 'SKILL_EDIT.GUIDE_ADD' | translate }}</li>
          <li><mat-icon>delete</mat-icon> {{ 'SKILL_EDIT.GUIDE_DELETE' | translate }}</li>
        </ul>
      </div>
    </div>
    
    <!-- Search Section -->
    <div class="search-section" *ngIf="isAdmin">
      <div class="search-container">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>{{ 'SKILL_EDIT.SEARCH_PLACEHOLDER' | translate }}</mat-label>
          <input matInput 
                 [(ngModel)]="searchQuery" 
                 (input)="onSearchInput($event)"
                 placeholder="{{ 'SKILL_EDIT.SEARCH_PLACEHOLDER' | translate }}">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        
        <!-- Search Results -->
        <div class="search-results" *ngIf="isSearching && searchResults.length > 0">
          <div class="search-results-header">
            <span>{{ 'SKILL_EDIT.SEARCH_RESULTS' | translate }} ({{ searchResults.length }})</span>
            <button mat-icon-button (click)="clearSearch()" class="clear-search-btn">
              <mat-icon>close</mat-icon>
            </button>
          </div>
          <div class="search-results-list">
            <div class="search-result-item" 
                 *ngFor="let result of searchResults" 
                 (click)="scrollToSkill(result)">
              <div class="result-content">
                <span class="result-name">{{ result.name }}</span>
                <span class="result-path" 
                      *ngIf="result.searchPath !== result.name">{{ result.searchPath }}</span>
              </div>
              <mat-icon class="result-icon">arrow_forward</mat-icon>
            </div>
          </div>
        </div>
        
        <!-- No Results -->
        <div class="no-results" *ngIf="isSearching && searchResults.length === 0 && searchQuery.length >= 2">
          <mat-icon>search_off</mat-icon>
          <span>{{ 'SKILL_EDIT.NO_SEARCH_RESULTS' | translate }}</span>
        </div>
      </div>
    </div>

    <!-- Controls inside the header box -->
    <div class="controls-section">
      <div class="tree-controls">
        <button class="control-btn" (click)="toggleAll()">
          <mat-icon>{{ isAllExpanded ? 'unfold_less' : 'unfold_more' }}</mat-icon>
          {{ isAllExpanded ? ('SKILL_EDIT.COLLAPSE_ALL' | translate) : ('SKILL_EDIT.EXPAND_ALL' | translate) }}
        </button>
        <button class="control-btn add-root-btn" (click)="addSkill()">
          <mat-icon>add</mat-icon>
          {{ 'SKILL_EDIT.ADD_ROOT_SKILL' | translate }}
        </button>
      </div>
    </div>
    </div>
  </div>

  <div class="skill-hierarchy">
    <app-skill-tree-node
      *ngFor="let root of skillTree"
      [skill]="root"
      [depth]="0"
      [isAdmin]="isAdmin"
      (toggleExpand)="toggleExpand($event)"
      (startEditing)="startEditing($event)"
      (saveEdit)="saveEdit($event)"
      (cancelEdit)="cancelEdit($event)"
      (addSkill)="addSkill($event)"
      (deleteSkill)="deleteSkill($event)"
    ></app-skill-tree-node>
  </div>
</div>
